{"is_source_file": true, "format": "Kotlin", "description": "This file implements the core Tetris game engine for an Android TV Tetris application. It manages game state, piece spawning and movement, rotation with SRS-like kicks, collision detection, line clearing, scoring, levels, piece hold functionality, and queue management. It is independent of Android UI components, focusing solely on game logic.", "external_files": ["com/example/tetris_android_tv_frontend/game/BoardState.kt", "com/example/tetris_android_tv_frontend/game/BoardCell.kt", "com/example/tetris_android_tv_frontend/game/PieceState.kt", "com/example/tetris_android_tv_frontend/game/TetrominoType.kt", "com/example/tetris_android_tv_frontend/game/Rotation.kt", "com/example/tetris_android_tv_frontend/game/SRS.kt", "com/example/tetris_android_tv_frontend/game/SevenBagRNG.kt", "com/example/tetris_android_tv_frontend/game/Coord.kt"], "external_methods": ["SRS.kicks(TetrominoType, Rotation, Rotation)", "SevenBagRNG.next()", "SevenBagRNG.reseed(Long)"], "published": ["ScoreState", "GameSnapshot", "TetrisEngine"], "classes": [{"name": "ScoreState", "description": "Data class representing the current score, level, and total lines cleared."}, {"name": "GameSnapshot", "description": "Immutable snapshot of the game state, including board, active piece, queue, hold piece, score, and game over status."}, {"name": "TetrisEngine", "description": "Main class encapsulating the Tetris game logic, handling game mechanics such as piece spawning, movement, rotation, line clearing, scoring, hold, and game state management."}], "methods": [{"name": "snapshot", "description": "Returns the current game state encapsulated in a GameSnapshot object."}, {"name": "reset", "description": "Resets the game to its initial state, optionally with a new random seed."}, {"name": "tickGravity", "description": "Advances the active piece downward according to gravity; locks the piece if it cannot move further."}, {"name": "softDrop", "description": "Temporarily accelerates the active piece downward, awarding points per cell moved down."}, {"name": "hardDrop", "description": "Permanently drops the active piece to the lowest possible position, awarding extra points."}, {"name": "moveLeft", "description": "Attempts to move the active piece left."}, {"name": "moveRight", "description": "Attempts to move the active piece right."}, {"name": "rotateCW", "description": "Rotates the active piece clockwise, with wall kicks applied."}, {"name": "rotateCCW", "description": "Rotates the active piece counter-clockwise, with wall kicks applied."}, {"name": "hold", "description": "Swaps the current active piece with the held piece, if hold is enabled and allowed."}, {"name": "isGameOver", "description": "Returns whether the game has ended."}], "calls": ["tryMove(PieceState, Coord)", "lockActiveAndProceed()", "clearFullLines(BoardState)", "scoreStateAfterClear(ScoreState, Int)", "spawnPosition(TetrominoType)", "ensureQueue(Int)", "nextFromQueue()", "resolveHoldIncoming(TetrominoType)"], "search-terms": ["TetrisEngine", "hold", "spawnNext", "lockActive", "scoreState", "rotateCW", "rotation", "line clear", "7-bag queue", "game over logic"], "state": 2, "file_id": 18, "knowledge_revision": 43, "git_revision": "c3d5b600dd7a0cf2f2c269524aef2675df196c50", "revision_history": [{"38": ""}, {"40": "1993040eb212919dd2acb3a4ca0a62a027d79fd6"}, {"41": "708797a207bc0a937fdf415b12ce127573b3eb39"}, {"43": "c3d5b600dd7a0cf2f2c269524aef2675df196c50"}], "hash": "3687fc026a515d8bb752c62737e6c29e", "format-version": 4, "code-base-name": "tetris_android_tv_frontend", "filename": "tetris_android_tv_frontend/app/src/main/java/com/example/tetris_android_tv_frontend/game/TetrisEngine.kt"}